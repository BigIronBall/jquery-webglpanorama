/*
 * jquery-webglpanorama
 * https://github.com/ulfbiallas/jquery-webglpanorama
 *
 * Copyright (c) 2014-2015 Ulf Biallas
 * Licensed under the MIT license.
 */
!function(t){function e(t){for(var e=t.context,i=(t.options.images.length,0);2>i;++i)t.textures.push({texture_xn:"",texture_xp:"",texture_yn:"",texture_yp:"",texture_zn:"",texture_zp:"",img_xp:"",img_xn:"",img_yp:"",img_yn:"",img_zp:"",img_zn:""}),t.textures[i].texture_xp=e.createTexture(),t.textures[i].img_xp=new Image,t.textures[i].img_xp.tex=t.textures[i].texture_xp,t.textures[i].img_xp.onload=function(){r(e,this)},t.textures[i].img_xp.src=t.options.images[i].xp,t.textures[i].texture_xn=e.createTexture(),t.textures[i].img_xn=new Image,t.textures[i].img_xn.tex=t.textures[i].texture_xn,t.textures[i].img_xn.onload=function(){r(e,this)},t.textures[i].img_xn.src=t.options.images[i].xn,t.textures[i].texture_yp=e.createTexture(),t.textures[i].img_yp=new Image,t.textures[i].img_yp.tex=t.textures[i].texture_yp,t.textures[i].img_yp.onload=function(){r(e,this)},t.textures[i].img_yp.src=t.options.images[i].yp,t.textures[i].texture_yn=e.createTexture(),t.textures[i].img_yn=new Image,t.textures[i].img_yn.tex=t.textures[i].texture_yn,t.textures[i].img_yn.onload=function(){r(e,this)},t.textures[i].img_yn.src=t.options.images[i].yn,t.textures[i].texture_zp=e.createTexture(),t.textures[i].img_zp=new Image,t.textures[i].img_zp.tex=t.textures[i].texture_zp,t.textures[i].img_zp.onload=function(){r(e,this)},t.textures[i].img_zp.src=t.options.images[i].zp,t.textures[i].texture_zn=e.createTexture(),t.textures[i].img_zn=new Image,t.textures[i].img_zn.tex=t.textures[i].texture_zn,t.textures[i].img_zn.onload=function(){r(e,this)},t.textures[i].img_zn.src=t.options.images[i].zn}function r(t,e){t.bindTexture(t.TEXTURE_2D,e.tex),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}function i(){return"            attribute vec4 aPosition;            attribute vec2 aUV;            uniform mat4 modelviewMatrix;            uniform mat4 projectionMatrix;            varying vec2 vUV;            void main() {                gl_Position = projectionMatrix * modelviewMatrix * aPosition;                vUV = aUV;            }        "}function a(){return"            precision mediump float;            varying vec2 vUV;            uniform sampler2D uSampler;            void main() {                gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);                gl_FragColor = texture2D(uSampler, vUV);            }        "}function n(t){var e=t.context;t.pShader=e.createProgram(),t.vShader=e.createShader(e.VERTEX_SHADER),e.shaderSource(t.vShader,i()),e.compileShader(t.vShader),e.attachShader(t.pShader,t.vShader),t.fShader=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(t.fShader,a()),e.compileShader(t.fShader),e.attachShader(t.pShader,t.fShader),e.linkProgram(t.pShader),e.useProgram(t.pShader)}function s(t){var e=new Float32Array([-1,-1,1,0,1,1,-1,1,1,1,1,1,1,1,0,-1,1,1,0,0,-1,-1,-1,1,1,-1,1,-1,1,0,1,1,-1,0,0,1,-1,-1,0,1,-1,1,-1,0,0,-1,1,1,0,1,1,1,1,1,1,1,1,-1,1,0,-1,-1,-1,0,1,1,-1,-1,1,1,1,-1,1,1,0,-1,-1,1,0,0,1,-1,-1,1,1,1,1,-1,1,0,1,1,1,0,0,1,-1,1,0,1,-1,-1,-1,0,1,-1,-1,1,1,1,-1,1,1,1,0,-1,1,-1,0,0]),r=new Uint16Array([0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8,12,13,14,14,15,12,16,17,18,18,19,16,20,21,22,22,23,20]),i=t.context,a=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW);var n=i.createBuffer();i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n),i.bufferData(i.ELEMENT_ARRAY_BUFFER,r,i.STATIC_DRAW);var s=i.getAttribLocation(t.pShader,"aPosition"),o=i.getAttribLocation(t.pShader,"aUV");i.enableVertexAttribArray(s),i.enableVertexAttribArray(o),i.vertexAttribPointer(s,3,i.FLOAT,!1,20,0),i.vertexAttribPointer(o,2,i.FLOAT,!1,20,12)}function o(t){var e=t.context,r=Math.cos(Math.PI*t.phi/180)*Math.cos(Math.PI*t.theta/180),i=Math.sin(Math.PI*t.theta/180),a=Math.sin(Math.PI*t.phi/180)*Math.cos(Math.PI*t.theta/180),n=new x(r,i,a),s=new x(0,0,0),h=new u;h.lookAt(s,s.add(n),new x(0,1,0));var m=new u,d=e.drawingBufferWidth/e.drawingBufferHeight;m.perspective(t.options.fov,d,.1,2),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT),e.uniformMatrix4fv(e.getUniformLocation(t.pShader,"modelviewMatrix"),!1,h.data()),e.uniformMatrix4fv(e.getUniformLocation(t.pShader,"projectionMatrix"),!1,m.data()),e.uniform1i(e.getUniformLocation(t.pShader,"uSampler"),0);var _=t.tid;e.bindTexture(e.TEXTURE_2D,t.textures[_].texture_zp),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),e.bindTexture(e.TEXTURE_2D,t.textures[_].texture_zn),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,12),e.bindTexture(e.TEXTURE_2D,t.textures[_].texture_yp),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,24),e.bindTexture(e.TEXTURE_2D,t.textures[_].texture_yn),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,36),e.bindTexture(e.TEXTURE_2D,t.textures[_].texture_xp),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,48),e.bindTexture(e.TEXTURE_2D,t.textures[_].texture_xn),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,60),t.animationId=requestAnimationFrame(function(){return o(t)})}function u(){this.values=new Float32Array(16),this.setToZero=function(){var t;for(t=0;16>t;++t)this.values[t]=0},this.setToIdentity=function(){var t;for(t=0;16>t;++t)this.values[t]=0;for(t=0;4>t;++t)this.values[4*t+t]=1},this.lookAt=function(t,e,r){if(0==t.sub(e).norm2())this.setToIdentity();else{var i=e.sub(t).normalize(),a=r.normalize(),n=i.cross(a).normalize(),s=n.cross(i).normalize();this.values[0]=n.x,this.values[4]=n.y,this.values[8]=n.z,this.values[1]=s.x,this.values[5]=s.y,this.values[9]=s.z,this.values[2]=-i.x,this.values[6]=-i.y,this.values[10]=-i.z,this.values[3]=0,this.values[7]=0,this.values[11]=0,this.values[15]=1,this.values[12]=-n.dot(t),this.values[13]=-s.dot(t),this.values[14]=i.dot(t)}},this.perspective=function(t,e,r,i){this.setToZero();var a=h(t*Math.PI/360);this.values[0]=a/e,this.values[5]=a,this.values[10]=(i+r)/(r-i),this.values[11]=-1,this.values[14]=2*i*r/(r-i)},this.data=function(){return this.values}}function x(t,e,r){this.x=t,this.y=e,this.z=r,this.add=function(i){return new x(t+i.x,e+i.y,r+i.z)},this.sub=function(i){return new x(t-i.x,e-i.y,r-i.z)},this.dot=function(i){return t*i.x+e*i.y+r*i.z},this.scale=function(i){return new x(t*i,e*i,r*i)},this.cross=function(i){return new x(e*i.z-r*i.y,r*i.x-t*i.z,t*i.y-e*i.x)},this.norm2=function(){return t*t+e*e+r*r},this.norm=function(){return Math.sqrt(this.norm2())},this.normalize=function(){var t=this.norm();return t>0?this.scale(1/t):this}}function h(t){return 1/Math.tan(t)}t.fn.panorama=function(r){return this.each(function(){var i={fov:90};t.extend(i,r),this.webglpanoramadata={context:"",vShader:"",fShader:"",pShader:"",animationId:0,phi:-90,phiOld:0,theta:0,thetaOld:0,mousedown:!1,mousePosX:0,mousePosY:0,mousePosOldX:0,mousePosOldY:0,textures:[],tid:1,options:i};var a=this.webglpanoramadata;t(this).mousemove(function(t){a.mousedown&&(a.mousePosX=t.pageX,a.mousePosY=t.pageY,a.phi=a.phiOld+.2*(a.mousePosX-a.mousePosOldX),a.theta=a.thetaOld-.2*(a.mousePosY-a.mousePosOldY),a.theta>90&&(a.theta=90),a.theta<-90&&(a.theta=-90))}),t(this).mousedown(function(t){a.mousedown=!0,a.phiOld=a.phi,a.thetaOld=a.theta,a.mousePosOldX=t.pageX,a.mousePosOldY=t.pageY}),t(this).mouseup(function(){a.mousedown=!1}),t(this).mouseout(function(){a.mousedown=!1}),a.context=this.getContext("experimental-webgl"),e(a),n(a),s(a),a.animationId=requestAnimationFrame(function(){return o(a)})}),this},t.fn.previous=function(){this.each(function(){this.webglpanoramadata.tid>0&&this.webglpanoramadata.tid--})},t.fn.next=function(){this.each(function(){this.webglpanoramadata.tid<this.webglpanoramadata.textures.length-1&&this.webglpanoramadata.tid++})}}(jQuery);